<?php
    session_start();
    $connected = false;
    if (isset($_SESSION['pseudo'])) {
        $fichier = file('./files/accounts.csv');
        for ($k = 0; $k < sizeof($fichier); $k++){
            $ligne = explode(';', $fichier[$k]);
            if ($ligne[0] == $_SESSION['pseudo']){
                $connected= true;
                break;
            }
        }
    }

    // Ajoute +1 au compteur de visite.
    $fichier = fopen('./files/visites.txt', "r");
    $nbVisite = intval(fgets($fichier));
    fclose($fichier);
    $nbVisite += 1;
    $fichier = fopen("./files/visites.txt", "w");
    fwrite($fichier, strval($nbVisite));
    fclose($fichier);
?>

<!DOCTYPE html>
<html lang='fr'>
	<head>
		<title>Meteo</title>
		<meta charset="utf-8"/>
		<link rel="stylesheet" type="text/css" href="./assets/style.css"/>
	</head>

	<body>
		<header>
			<a href="index.php"><img id="logo" alt="Logo" src="./assets/logo_site.jpg"/></a>
			<h1 id="main_title">Météo</h1>
            <?php
                if ($connected){
                    echo "<a id='bouton_deconnexion' href='./scripts/deconnexion.php'>Deconnexion</a>";
                    echo "<a id='compte_user' href='subpages/compte.php'>Comptes</a>";
                }
                else{
                    echo "<a id='register' href='./subpages/page_inscription.php?id_error=0'>Inscription</a>";
                    echo "<a id='connection' href='./subpages/page_connexion.php?id_error=0'>Connexion</a>";
                }
            ?>

		</header>

		<div class="conteneur">
			<div id="carte">
				<h2>Choisissez la région</h2>

				<map name="carte_region">
					<area id="haut_de_france" shape="poly" href="#menu_deroulant" coords="367,6,331,16,325,20,324,33,325,44,322,62,316,76,327,87,331,97,330,104,328,108,332,116,330,124,333,133,328,133,328,136,337,139,344,137,353,139,369,145,371,143,374,147,378,143,381,146,389,145,392,143,396,148,395,149,399,155,409,161,418,151,416,148,415,143,420,140,418,138,416,131,423,127,427,123,434,126,435,114,433,108,437,106,443,100,441,93,441,85,438,82,441,77,438,70,443,63,433,58,423,58,418,58,416,50,409,45,403,45,399,38,394,27,388,29,384,34,375,27,370,25,370,16" alt="Haut-de-France"/>

					<area id="normandie" shape="poly" href="#menu_deroulant" coords="316,77,304,86,285,89,269,96,260,100,256,108,256,115,267,119,256,122,242,129,232,124,207,119,200,121,193,108,199,103,195,99,188,96,182,100,166,94,166,97,169,103,167,115,169,115,174,122,178,131,179,146,175,156,179,164,188,170,179,172,179,178,185,183,192,177,200,180,206,180,214,184,220,184,233,182,239,178,242,179,244,186,246,186,248,189,252,190,260,185,264,186,267,190,268,196,278,201,285,206,284,196,293,189,292,184,286,173,290,168,299,166,312,165,315,160,318,153,316,149,318,146,324,144,327,134,330,130,327,122,330,119,327,111,328,106,326,102,329,98,326,89,317,80"
					alt="Normandie"/>

					<area id="ile_de_france" shape="poly" href="#menu_deroulant" coords="328,138,325,146,319,148,321,152,320,156,323,158,324,165,325,168,324,172,329,177,330,181,334,188,338,188,340,188,340,191,341,197,347,198,350,194,354,198,356,194,359,198,361,198,362,202,365,203,366,207,362,211,373,211,374,207,378,208,384,207,388,203,387,193,404,192,404,186,408,179,411,177,407,174,404,167,407,163,398,155,393,151,392,147,383,148,375,148,363,145,354,141,345,139,336,140,330,138"
					alt="Île-de-France"/>

					<area id="grand_est" shape="poly" href="#menu_deroulant" coords="442,85,444,94,442,101,436,108,435,117,434,126,429,125,428,126,426,129,419,129,419,134,421,139,416,140,418,145,417,154,407,166,410,175,413,178,407,189,409,192,412,197,416,202,417,207,423,209,431,222,441,222,446,222,448,220,455,220,460,215,471,219,475,224,481,231,478,236,481,239,485,240,493,245,497,245,498,240,506,239,511,240,512,237,510,231,516,226,522,219,529,215,533,216,536,221,543,219,549,223,554,218,556,222,563,224,567,230,574,233,577,238,576,244,581,246,583,250,585,252,589,252,593,249,598,243,597,233,600,212,604,191,612,164,618,156,624,147,611,141,593,141,589,135,572,137,565,132,555,136,546,120,532,113,524,118,512,110,498,113,477,95,471,93,468,84,468,70,462,81,451,85"
					alt="Grand-Est"/>

					<area id="bretagne" shape="poly" href="#menu_deroulant" coords="176,171,165,166,156,169,144,167,126,177,110,153,103,152,87,153,86,163,76,157,72,164,66,157,54,160,32,166,31,179,46,177,59,189,40,184,41,190,48,190,51,195,50,199,35,199,45,207,46,216,54,217,58,208,70,220,92,229,101,239,114,245,130,244,132,249,138,249,139,245,145,246,147,243,153,234,166,233,177,226,183,225,189,228,193,216,198,214,196,198,198,194,199,183,192,180,186,185,180,181,177,177"
					alt="Bretagne"/>

					<area id="pays_de_la_loire" shape="poly" href="#menu_deroulant" coords="212,191,212,200,210,208,212,216,212,225,203,230,199,239,195,241,188,237,183,242,174,246,162,247,159,250,158,258,150,261,142,261,136,264,140,271,145,272,150,277,152,282,156,287,158,297,152,304,157,312,164,325,168,333,194,346,204,340,209,341,215,344,220,343,221,330,218,317,212,304,208,298,224,296,225,291,245,288,252,287,257,283,262,268,263,256,268,252,276,252,284,249,286,244,289,244,294,235,295,230,296,220,292,216,283,211,276,207,274,205,274,198,270,197,266,201,259,202,253,200,249,194,243,192,237,192,230,194,222,196,218,194"
					alt="Pays de la Loire"/>

					<area id="centre_val_de_loire" shape="poly" href="#menu_deroulant" coords="319,160,316,166,311,168,304,168,300,168,294,171,290,174,293,181,296,187,293,195,288,196,288,202,291,209,289,216,288,222,287,229,282,236,274,242,268,249,261,252,261,249,260,249,258,252,256,262,251,275,259,282,263,289,269,288,273,286,280,288,280,293,289,308,296,319,304,330,312,326,325,328,328,323,350,327,352,322,365,320,364,313,371,308,374,303,379,307,385,299,387,294,384,273,384,273,379,268,381,259,377,252,380,250,382,248,379,240,379,235,385,233,386,224,390,220,385,211,363,215,358,213,362,207,352,202,340,203,337,195,329,190,328,185,320,176,320,167"
					alt="Centre-val de Loire"/>

					<area id="bourgogne_franche_comte" shape="poly" href="#menu_deroulant" coords="405,197,390,198,388,207,393,213,393,223,392,227,391,231,386,240,387,245,385,251,385,258,387,267,390,278,394,299,391,306,397,307,403,307,411,309,413,303,419,305,422,309,426,320,434,322,438,324,437,329,435,333,435,338,435,340,435,343,449,343,452,336,468,333,471,336,475,322,480,317,487,318,495,319,506,334,511,329,516,331,520,335,532,326,530,315,547,300,547,288,557,282,570,263,566,256,573,247,570,238,552,225,537,221,529,220,520,227,517,235,508,244,501,246,485,246,472,234,471,227,461,222,446,228,428,226,421,218,410,203"
					alt="Bourgogne-Franche-Comté"/>

					<area id="nouvelle_aquitaine" shape="poly" href="#menu_deroulant" coords="190,334,185,372,190,396,184,408,174,483,169,504,155,534,158,536,166,541,167,551,202,566,214,571,220,559,230,548,233,532,227,525,222,519,222,508,227,498,233,493,267,489,275,485,281,479,279,473,280,468,287,459,304,435,307,423,317,422,325,425,328,426,340,426,350,402,357,397,358,389,358,382,356,376,355,366,361,361,361,356,361,348,357,343,347,335,336,334,322,334,303,334,291,323,285,315,281,308,273,292,260,293,249,280,242,286,227,283,219,287,209,288,216,297,217,304,217,322,219,330,212,336,198,333"
					alt="Nouvelle-Aquitaine"/>

					<area id="auvergne_rhones_alpes" shape="poly" href="#menu_deroulant" coords="385,308,373,312,371,319,367,325,359,325,356,328,361,336,365,342,369,354,370,359,364,371,367,382,366,398,363,405,357,406,352,414,349,426,345,432,350,446,358,448,370,431,375,429,379,431,384,441,385,440,390,438,391,431,403,426,407,428,411,436,415,432,422,435,425,437,430,443,436,450,435,454,439,461,443,470,447,472,457,471,465,471,475,473,478,470,482,466,484,466,487,467,492,471,492,471,499,474,502,479,509,480,510,484,517,480,514,474,507,467,505,460,506,456,513,453,518,447,525,442,530,436,537,433,543,431,549,432,547,427,541,422,543,418,546,415,549,415,554,418,555,414,564,411,574,409,582,404,587,395,578,382,569,372,569,365,573,361,577,358,578,355,568,345,564,332,566,326,555,326,547,329,544,333,547,342,542,344,532,347,527,339,531,334,533,330,528,334,526,339,517,339,514,336,510,342,506,339,497,334,492,328,481,325,479,336,473,348,469,348,467,341,457,340,453,347,447,350,434,345,426,343,430,336,432,330,426,326,421,324,415,312,407,318,391,310"
					alt="Auvergne-Rhônes-Alpes"/>

					<area id="occitanie" shape="poly" href="#menu_deroulant" coords="338,432,327,43,320,428,312,428,311,435,307,442,303,450,296,451,295,454,289,460,292,469,288,474,286,479,286,484,281,488,276,492,271,496,265,496,254,499,245,500,234,502,231,502,227,511,225,520,234,520,236,524,236,528,238,538,236,544,233,551,220,570,226,577,231,582,242,580,248,580,260,580,268,583,266,574,270,571,276,574,290,578,299,581,304,586,312,588,323,591,325,593,325,598,328,600,332,601,336,604,345,600,349,603,360,608,368,610,371,603,379,602,385,602,394,602,389,596,387,592,386,566,393,558,396,552,404,545,412,543,439,525,443,525,444,530,448,531,457,523,458,518,460,516,466,514,466,508,466,504,474,497,474,494,474,494,470,491,470,484,462,476,458,478,453,478,448,480,441,477,436,476,437,470,428,446,417,440,412,443,407,442,406,432,400,436,394,440,390,447,387,453,384,454,380,448,380,442,375,434,372,442,368,440,367,448,362,451,359,454,352,454,342,454,342,445,341,437"
					alt="Occitanie"/>

					<area id="alpes_cote_dazur" shape="poly" href="#menu_deroulant" coords="548,418,547,423,552,426,552,427,554,434,552,436,547,436,541,436,536,440,530,443,526,446,526,450,519,452,520,456,520,458,518,462,510,465,513,469,520,472,521,474,521,478,522,486,517,486,515,488,510,488,502,484,501,482,494,481,491,479,489,476,485,477,482,480,477,480,474,476,470,476,472,480,475,484,475,486,479,493,479,495,478,499,476,502,474,503,472,508,470,515,470,517,466,519,463,520,463,524,451,532,465,532,467,536,468,538,476,539,480,535,486,536,488,537,492,540,502,538,506,539,506,544,508,547,528,555,532,558,536,552,545,554,552,552,558,552,570,547,570,543,567,541,571,538,583,529,612,504,609,500,614,492,617,490,620,484,616,482,605,484,598,482,587,478,580,469,577,457,576,452,582,443,584,440,580,434,571,434,570,427,563,419,557,422,554,422"
					alt="Alpes-Côtesd'Azur"/>

					<area id="corse" shape="poly" href="#menu_deroulant" coords="648,516,648,532,646,539,640,537,636,538,632,543,627,542,619,550,618,551,613,562,616,568,614,572,614,576,620,580,616,591,622,592,625,597,623,601,628,605,631,610,626,614,630,618,640,620,646,626,650,620,653,606,656,592,654,584,660,577,656,544,652,538,652,519,651,517"
					alt="Corse"/>
				</map>

				<img src="./assets/carte_france.png" usemap="#carte_region" alt="Carte de la France"/>
			</div>

			<div id="menu_deroulant">
				<h2>Choisissez un département et une ville</h2>

				<div id="menus">
					<div id="departements">
						<h3>Départements</h3>
							<label for="menu_d">Choisissez un département:</label>

							<select id="menu_d" onchange="afficherCommunes();">
								<option value=''>...</option>
							</select>
					</div>

					<div id="villes">
						<h3>Villes</h3>
							<label for="menu_v">Choisissez une ville:</label>

							<select id="menu_v">
                                <?php
                                if (isset($_COOKIE['ville'])) {
                                    echo "<option value='" . $_COOKIE['ville'] . "'>" . $_COOKIE['ville'] . "</option>";
                                }
                                else{
                                    echo "<option value=''>...</option>";
                                }
                                ?>

							</select>
					</div>

					<div id="options_affichage">
                        <h3>Plage horaire</h3>
                            <table>
                                <tr>
                                    <td><label for="h_debut">Heure du matin:</label></td>
                                    <?php
                                        if (isset($_COOKIE['h_debut'])){
                                            echo "<td><input type='number' id='h_debut' min='0' max='23' value='"
                                            . $_COOKIE['h_debut'] . "'/></td>";
                                        }
                                        else{
                                            echo "<td><input type='number' id='h_debut' min='0' max='23'/></td>";
                                        }
                                    ?></tr>
                                <tr><td><label for="h_fin">Heure de soirée:</label></td>
                                    <?php
                                    if (isset($_COOKIE['h_fin'])){
                                        echo "<td><input type='number' id='h_fin' min='0' max='23' value='"
                                            . $_COOKIE['h_fin'] . "'/></td>";
                                    }
                                    else{
                                        echo "<td><input type='number' id='h_fin' min='0' max='23'/></td>";
                                    }
                                    ?></tr>
                            </table>

						<h3>Paramètre</h3>
							<div class="options">
                                <?php
                                 if (isset($_COOKIE['actuel'])){
                                     if ($_COOKIE['actuel'] == true){
                                         echo "<input type='checkbox' id='jour_actuel' checked />";
                                     }
                                 }
                                 else{
                                     echo "<input type='checkbox' id='jour_actuel'/>";
                                 }
                                ?>

                            <label for="jour_actuel">Afficher la météo du jour actuel.</label>
							</div>
							<div class="options">
                                <?php
                                    if (isset($_COOKIE['jours'])){
                                        if ($_COOKIE['jours'] == true) {
                                            echo "<input type='checkbox' id='3_jours' checked />";
                                        }
                                    }
                                    else{
                                        echo "<input type='checkbox' id='3_jours'/>";
                                    }
                                ?>

                                <label for="3_jours">Afficher la météo pour 3 jours.</label>
                            </div>
                            <div id="choix_preferences">
                                    <input type="checkbox" id="preferences"/>
                                    <label for="preferences">Enregistrer ces paramètres en tant que préférences.</label>
                            </div>
					</div>

                    <button id="get_meteo" type="button" onclick="getMeteo();">Avoir la météo</button>
				</div>

				<script src="./scripts/departements.js"></script>
			</div>

		</div>
	</body>
</html>